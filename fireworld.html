<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>From pmt with luv ðŸ©µ</title>
<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
}
canvas{
    position:absolute;
    top:0;
    left:0;
}
#start{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    padding: 15px 40px;
    font-size: 24px;
    background: #f60101;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    
    z-index: 10; /* Ä‘áº£m báº£o ná»•i trÃªn canvas */
}
</style>
</head>
<body>

<button id="start">From pmt with luv ðŸ©µ</button>
<canvas id="canvas"></canvas>

<audio id="boomBase" src="boom.mp3"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let rockets=[];
let particles=[];
let bgParticles=[];
let textPoints=[];
let showText=false;

const boomBase = document.getElementById("boomBase");

// ===== BOOM CHá»’NG TIáº¾NG =====
function playBoom(){
    const sound = boomBase.cloneNode();
    sound.volume = Math.random() * 0.5 + 0.5; // Ã¢m lÆ°á»£ng ngáº«u nhiÃªn 0.5 â†’ 1
    sound.play();
}

// ===== ROCKET =====
class Rocket{
    constructor(x){
        this.x=x;
        this.y=canvas.height;
        this.targetY=canvas.height/3;
        this.speed=7;
        this.exploded=false;
    }
    update(){
        if(!this.exploded){
            this.y-=this.speed;
            if(this.y<=this.targetY){
                this.exploded=true;
                if(showText){
                    explodeToText(this.x,this.y);
                }
            }
        }
    }
    draw(){
        ctx.fillStyle="white";
        ctx.fillRect(this.x,this.y,3,6);
    }
}

// ===== PARTICLE =====
class Particle{
    constructor(x,y,tx,ty,color){
        this.x=x;
        this.y=y;
        this.tx=tx;
        this.ty=ty;
        this.color=color;
    }
    update(){
        this.x+=(this.tx-this.x)*0.05;
        this.y+=(this.ty-this.y)*0.05;
    }
    draw(){
        ctx.fillStyle=this.color;
        ctx.fillRect(this.x,this.y,2,2);
    }
}

// ===== BG FIREWORK (DÃ€Y HÆ N) =====
class BgParticle{
    constructor(x,y){
        this.x=x;
        this.y=y;
        this.speed=Math.random()*5+3;
        this.angle=Math.random()*Math.PI*2;
        this.alpha=1;
        this.color=`hsl(${Math.random()*360},100%,60%)`;
    }
    update(){
        this.x+=Math.cos(this.angle)*this.speed;
        this.y+=Math.sin(this.angle)*this.speed;
        this.alpha-=0.015;
    }
    draw(){
        ctx.globalAlpha=this.alpha;
        ctx.fillStyle=this.color;
        ctx.fillRect(this.x,this.y,3,3);
        ctx.globalAlpha=1;
    }
}

function createBgFirework(){
    const x=Math.random()*canvas.width;
    const y=Math.random()*canvas.height/2;

    for(let i=0;i<100;i++){  // tÄƒng sá»‘ háº¡t cho dÃ y hÆ¡n
        bgParticles.push(new BgParticle(x,y));
    }

    playBoom();
}

// ===== TEXT =====
function prepareText(){
    const temp=document.createElement("canvas");
    const tctx=temp.getContext("2d");
    temp.width=canvas.width;
    temp.height=canvas.height;

    tctx.fillStyle="white";
    tctx.font="bold 120px Arial";
    tctx.textAlign="center";
    tctx.fillText("NÄ‚M Má»šI VUI Váºº",canvas.width/2,canvas.height/2);

    const data=tctx.getImageData(0,0,temp.width,temp.height).data;

    for(let y=0;y<temp.height;y+=5){
        for(let x=0;x<temp.width;x+=5){
            const i=(y*temp.width+x)*4;
            if(data[i+3]>128){
                textPoints.push({x,y});
            }
        }
    }
}

function explodeToText(x,y){
    textPoints.forEach(p=>{
        particles.push(new Particle(x,y,p.x,p.y,"#ffffff"));
    });
    playBoom();
}

// ===== ANIMATE =====
function animate(){
    ctx.fillStyle="rgba(0,0,0,0.2)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    rockets.forEach(r=>{r.update();r.draw();});
    particles.forEach(p=>{p.update();p.draw();});

    bgParticles.forEach((p,i)=>{
        p.update();
        p.draw();
        if(p.alpha<=0) bgParticles.splice(i,1);
    });

    requestAnimationFrame(animate);
}

// ===== START =====
// ===== START =====
function randomFireLoop(){
    createBgFirework();

    // thá»i gian ngáº«u nhiÃªn 200ms â†’ 1200ms
    const nextTime = Math.random() * 1000 + 200;

    setTimeout(randomFireLoop, nextTime);
}

document.getElementById("start").addEventListener("click",()=>{

    // Ä‘áº£m báº£o chá»‰ cháº¡y 1 láº§n
    document.getElementById("start").disabled = true;

    randomFireLoop(); // loop ngáº«u nhiÃªn

    setTimeout(()=>{
        showText = true;
        rockets.push(new Rocket(canvas.width/2));
    },5000);

    document.getElementById("start").style.display="none";
});

prepareText();
animate();
</script>

</body>
</html>
